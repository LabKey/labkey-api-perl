# Setup Dev Enviornment

## Install Perl locally using Perlbrew

See https://perlbrew.pl/

Fetch perlbrew:
```sh
> curl -L https://install.perlbrew.pl | bash
```

Once installed, add "source ~/perl5/perlbrew/etc/bashrc" to .bashrc.

Install local version of Perl:
```
> perlbrew install perl-5.6.16
> perlbrew switch perl-5.6.16
```

Install cpanm
```sh
> perlbrew install-cpanm
```

Install dependencies into local perl
```sh
> cpanm install Module::Build
> cpanm --installdeps .
> cpanm install Software::License
```


# Development

Hack on project and test locally:
```sh
> perl Build.PL && ./Build && ./Build test
```

If it has been a while since the last version, update dependencies:
```sh
> cpan -u
```


# Publish Module to CPAN

## Prepare

Generate 'Build' script:
```sh
> perl Build.PL
```

Edit MANIFEST.SKIP if needed, add #!include_default to top.
Be sure not to check in the expanded version into git.
```sh
> vi MANIFEST.SKIP
> ./Build manifest
```

Bump version number -- Build.PL uses dist_version_from to find it:
```sh
> vi lib/LabKey/Query.pm
```

Update copyright year (LICENSE will be autogenerated):
```sh
> vi lib/LabKey/Query.pm
```

Update Changes file:
```sh
> vi Changes
```

Generate README.pod for nice viewing on github:
```sh
> podselect lib/LabKey/Query.pm > README.pod
```

Clean up 'Build' and distribution artifacts:
```sh
> ./Build distclean
```

Generate metadata files and dist (META.yml, META.json, LICENSE, LabKey-Query-0.00.tar.gz):
```sh
> perl Build.PL
> ./Build dist
```


# Push changes

Commit, tag, push:
```sh
> git commit
> git tag v<version>  # e.g. v1.06
> git push --tags -u origin master
```

# Publish to CPAN

Upload the distro using CPAN::Uploader
```sh
> cpan-upload LabKey-Query-v<version>.tar.gz --user labkey
```

